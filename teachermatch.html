<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teachermath Setup</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/teachermatch.css">
</head>
<body>

<div class="info-section">
  <h3>‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
  
  <div class="info-inputs">
    <input id="weekInput" placeholder="‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà">
    <input id="topicInput" placeholder="‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ">
    <input id="unitInput" placeholder="‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ">
    <input id="teacherInput" placeholder="‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö">
  </div>
</div>

<div class="main-container">
  <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</h3>
  <input id="questionInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÄ‡∏•‡∏Ç (‡πÄ‡∏ä‡πà‡∏ô 2 + 2 = ?)" style="max-width:500px; font-size:18px; padding:12px; border-radius:15px; margin-bottom:20px;"><br>
  <div style="display:flex; gap:5px; justify-content:center; margin-top:20px;">
    <div style="flex:1; background:rgba(76, 175, 80, 0.1); padding:15px; border-radius:10px; border:2px solid #4CAF50;">
      <label style="color:#4CAF50; font-weight:bold;">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚úÖ</label><br>
      <input id="correctAnswerInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å (‡πÄ‡∏ä‡πà‡∏ô 4)" style="max-width:300px; font-size:18px; padding:10px; margin:10px 0; border-radius:15px;">
      <button class="neon-btn" onclick="addAnswer('correct')" style="font-size:14px; padding:8px 16px; min-height:40px;">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
      <div id="correctAnswersList" style="margin-top:10px;"></div>
    </div>
    
    <div style="flex:1; background:rgba(244, 67, 54, 0.1); padding:15px; border-radius:10px; border:2px solid #f44336;">
      <label style="color:#f44336; font-weight:bold;">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î ‚ùå</label><br>
      <input id="wrongAnswerInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î (‡πÄ‡∏ä‡πà‡∏ô 3, 5, 6)" style="max-width:300px; font-size:18px; padding:10px; margin:10px 0; border-radius:15px;">
      <button class="neon-btn" onclick="addAnswer('wrong')" style="font-size:14px; padding:8px 16px; min-height:40px;">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
      <div id="wrongAnswersList" style="margin-top:10px;"></div>
    </div>
  </div>
  
  <button class="neon-btn-green" onclick="addQuestion()" style="margin-top:20px; font-size:14px; padding:8px 16px; min-height:40px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏à‡∏ó‡∏¢‡πå</button>
  
  <hr style="margin:30px 0; border:none; border-top:2px solid #ccc;">
  
  <h3>‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (<span id="questionCount">0</span> ‡∏Ç‡πâ‡∏≠)</h3>
  <div id="questionsList" style="max-height:400px; overflow-y:auto;"></div>
</div>

<!-- Control Buttons -->
<div style="display: flex; justify-content: center; gap: 15px; margin: 20px auto; max-width: 900px; flex-wrap: wrap;">
  <button class="neon-btn" onclick="saveConfig()" style="font-size: clamp(0.9rem, 1.8vw, 1.2rem); padding: 12px 25px;">üéÆ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>
  <button class="neon-btn" onclick="saveActivity()" style="font-size: clamp(0.9rem, 1.8vw, 1.2rem); padding: 12px 25px;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>
  <button class="neon-btn" onclick="loadActivity()" style="font-size: clamp(0.9rem, 1.8vw, 1.2rem); padding: 12px 25px;">üìÇ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>
</div>

<!-- Activity Selection Modal -->
<div id="activityModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 9999; align-items: center; justify-content: center;">
  <div style="background: linear-gradient(135deg, #f8f6f0 0%, #ebd09e 100%); padding: 30px; border-radius: 20px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; border: 5px solid #74640a;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h2 style="margin: 0; color: #251f03;">üìÇ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</h2>
      <button onclick="closeActivityModal()" style="background: #e74c3c; color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 20px;">‚úñ</button>
    </div>
    <div id="activityList"></div>
  </div>
</div>

<script>
let correctAnswers = [];
let wrongAnswers = [];
let allQuestions = []; // ‡πÄ‡∏Å‡πá‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
function addAnswer(type) {
  const inputId = type === 'correct' ? 'correctAnswerInput' : 'wrongAnswerInput';
  const input = document.getElementById(inputId);
  const answer = input.value.trim();
  
  if (!answer) {
    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö');
    return;
  }
  
  if (type === 'correct') {
    correctAnswers.push(answer);
    renderAnswers('correct');
  } else {
    wrongAnswers.push(answer);
    renderAnswers('wrong');
  }
  
  input.value = ''; // Clear input
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
function removeAnswer(type, index) {
  if (type === 'correct') {
    correctAnswers.splice(index, 1);
    renderAnswers('correct');
  } else {
    wrongAnswers.splice(index, 1);
    renderAnswers('wrong');
  }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
function renderAnswers(type) {
  const listId = type === 'correct' ? 'correctAnswersList' : 'wrongAnswersList';
  const answers = type === 'correct' ? correctAnswers : wrongAnswers;
  const list = document.getElementById(listId);
  
  list.innerHTML = answers.map((answer, i) => `
    <div class="choice-item">
      <span style="font-size:18px; font-weight:bold;">${answer}</span>
      <button onclick="removeAnswer('${type}', ${i})">‡∏•‡∏ö</button>
    </div>
  `).join('');
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå
function addQuestion() {
  const question = document.getElementById('questionInput').value.trim();
  
  if (!question) {
    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÄ‡∏•‡∏Ç');
    return;
  }
  
  if (correctAnswers.length === 0) {
    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö');
    return;
  }
  
  if (wrongAnswers.length === 0) {
    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö');
    return;
  }
  
  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÄ‡∏Ç‡πâ‡∏≤ array
  allQuestions.push({
    question: question,
    correctAnswers: [...correctAnswers],
    wrongAnswers: [...wrongAnswers]
  });
  
  // Clear form
  document.getElementById('questionInput').value = '';
  correctAnswers = [];
  wrongAnswers = [];
  renderAnswers('correct');
  renderAnswers('wrong');
  
  // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏à‡∏ó‡∏¢‡πå
  renderQuestionsList();
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
function renderQuestionsList() {
  const list = document.getElementById('questionsList');
  document.getElementById('questionCount').innerText = allQuestions.length;
  
  list.innerHTML = `<div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(150px, 1fr)); gap:8px;">` + 
    allQuestions.map((q, i) => `
      <div style="background:rgba(255,255,255,0.9); padding:8px; border-radius:6px; border:2px solid #74640a;">
        <div style="display:flex; justify-content:space-between; align-items:start; gap:5px;">
          <div style="flex:1; text-align:left;">
            <div style="margin:0 0 4px 0; color:#333; font-weight:bold; font-size:13px;">‡∏Ç‡πâ‡∏≠ ${i + 1}: ${q.question}</div>
            <div style="margin:2px 0; font-size:12px;">
              <span style="color:#4CAF50; font-weight:bold;">‚úì</span> ${q.correctAnswers.join(', ')}
            </div>
            <div style="margin:2px 0; font-size:12px;">
              <span style="color:#f44336; font-weight:bold;">‚úó</span> ${q.wrongAnswers.join(', ')}
            </div>
          </div>
          <button onclick="removeQuestion(${i})" style="background:#f44336; color:white; border:none; padding:4px 8px; border-radius:4px; cursor:pointer; font-size:11px;">‡∏•‡∏ö</button>
        </div>
      </div>
    `).join('') + `</div>`;
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå
function removeQuestion(index) {
  if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ô‡∏µ‡πâ?')) {
    allQuestions.splice(index, 1);
    renderQuestionsList();
  }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î (‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
function handleImageUpload(event, type) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    const img = new Image();
    img.onload = function() {
      // Auto crop to square
      const croppedImageData = autoCropToSquare(img);
      
      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏≤‡∏£‡πå‡πÄ‡∏£‡∏¢‡πå
      if (type === 'correct') {
        correctImages.push(croppedImageData);
        event.target.value = ''; // Clear input
        renderImages('correct');
      } else {
        wrongImages.push(croppedImageData);
        event.target.value = ''; // Clear input
        renderImages('wrong');
      }
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
function autoCropToSquare(img) {
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  
  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
  const maxSize = 300;
  let width = img.width;
  let height = img.height;
  
  // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ñ‡πâ‡∏≤‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡πÇ‡∏î‡∏¢‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô
  if (width > maxSize || height > maxSize) {
    if (width > height) {
      height = (height / width) * maxSize;
      width = maxSize;
    } else {
      width = (width / height) * maxSize;
      height = maxSize;
    }
  }
  
  canvas.width = width;
  canvas.height = height;
  
  // ‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏•‡∏á‡∏ö‡∏ô canvas
  ctx.drawImage(img, 0, 0, width, height);
  
  // ‡∏ï‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
  const imageData = ctx.getImageData(0, 0, width, height);
  const data = imageData.data;
  
  // ‡∏´‡∏≤‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡∏°‡∏∏‡∏° 4 ‡∏°‡∏∏‡∏°)
  const corners = [
    [0, 0], // ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô
    [width - 1, 0], // ‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô
    [0, height - 1], // ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏á
    [width - 1, height - 1] // ‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á
  ];
  
  let bgColor = null;
  for (let corner of corners) {
    const x = corner[0];
    const y = corner[1];
    const index = (y * width + x) * 4;
    const r = data[index];
    const g = data[index + 1];
    const b = data[index + 2];
    
    if (r > 200 && g > 200 && b > 200) { // ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á
      bgColor = { r, g, b };
      break;
    }
  }
  
  // ‡∏ï‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å (‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á)
  if (bgColor) {
    const threshold = 40; // ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏™‡∏µ
    for (let i = 0; i < data.length; i += 4) {
      const r = data[i];
      const g = data[i + 1];
      const b = data[i + 2];
      
      // ‡∏ñ‡πâ‡∏≤‡∏™‡∏µ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á ‡πÉ‡∏´‡πâ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™
      if (Math.abs(r - bgColor.r) < threshold && 
          Math.abs(g - bgColor.g) < threshold && 
          Math.abs(b - bgColor.b) < threshold) {
        data[i + 3] = 0; // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™
      }
    }
    
    ctx.putImageData(imageData, 0, 0);
  }
  
  // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô base64 (‡πÉ‡∏ä‡πâ PNG ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™)
  return canvas.toDataURL('image/png', 0.9);
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
function removeImage(type, index) {
  if (type === 'correct') {
    correctImages.splice(index, 1);
    renderImages('correct');
  } else {
    wrongImages.splice(index, 1);
    renderImages('wrong');
  }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
function renderImages(type) {
  const listId = type === 'correct' ? 'correctImagesList' : 'wrongImagesList';
  const images = type === 'correct' ? correctImages : wrongImages;
  const list = document.getElementById(listId);
  
  list.innerHTML = images.map((imgData, i) => `
    <div class="image-preview-item">
      <img src="${imgData}" alt="Image ${i+1}">
      <button class="remove-btn" onclick="removeImage('${type}', ${i})">√ó</button>
    </div>
  `).join('');
}

// ‡πÇ‡∏´‡∏•‡∏î config ‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
const savedConfig = JSON.parse(localStorage.getItem('emojiGameConfig')||'{}');
if(savedConfig.week) document.getElementById('weekInput').value = savedConfig.week;
if(savedConfig.topic) document.getElementById('topicInput').value = savedConfig.topic;
if(savedConfig.unit) document.getElementById('unitInput').value = savedConfig.unit;
if(savedConfig.teacher) document.getElementById('teacherInput').value = savedConfig.teacher;
if(savedConfig.questions) {
  allQuestions = savedConfig.questions;
  renderQuestionsList();
}
renderAnswers('correct');
renderAnswers('wrong');

function saveConfig(){
  const week = document.getElementById('weekInput').value.trim();
  const topic = document.getElementById('topicInput').value.trim();
  const unit = document.getElementById('unitInput').value.trim();
  const teacher = document.getElementById('teacherInput').value.trim();

  if(!week){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà"); return; }
  if(!topic){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ"); return; }
  if(!unit){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ"); return; }
  if(!teacher){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö"); return; }
  if(allQuestions.length === 0){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ç‡πâ‡∏≠"); return; }

  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å config ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  const config = {
    week: week,
    topic: topic,
    unit: unit,
    teacher: teacher,
    questions: allQuestions  // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô array ‡∏Ç‡∏≠‡∏á‡πÇ‡∏à‡∏ó‡∏¢‡πå
  };
  localStorage.setItem('emojiGameConfig', JSON.stringify(config));

  // ‡πÄ‡∏î‡πâ‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡∏°
  window.location.href='gamemath.html';
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
function saveActivity() {
  const week = document.getElementById('weekInput').value.trim();
  const topic = document.getElementById('topicInput').value.trim();
  const unit = document.getElementById('unitInput').value.trim();
  const teacher = document.getElementById('teacherInput').value.trim();

  if(!week){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà"); return; }
  if(!topic){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ"); return; }
  if(!unit){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ"); return; }
  if(!teacher){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö"); return; }
  if(allQuestions.length === 0){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ç‡πâ‡∏≠"); return; }

  let savedActivities = JSON.parse(localStorage.getItem('savedActivities') || '[]');
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏î‡∏¥‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  if (window.editingActivityId) {
    const activity = savedActivities.find(a => a.id === window.editingActivityId);
    
    if (activity) {
      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏î‡∏¥‡∏°
      activity.config = {
        week: week,
        topic: topic,
        unit: unit,
        teacher: teacher,
        questions: allQuestions
      };
      activity.topic = topic;
      activity.savedAtDisplay = new Date().toLocaleString('th-TH');
      
      localStorage.setItem('savedActivities', JSON.stringify(savedActivities));
      
      alert(`‚úÖ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° "${activity.name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
      
      // ‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
      delete window.editingActivityId;
      delete window.editingActivityName;
      return;
    }
  }
  
  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà
  const activityName = prompt('‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:', `${topic} - ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå ${week}`);
  
  if (!activityName) return;
  
  const activity = {
    id: Date.now(),
    name: activityName,
    type: 'math',
    topic: topic,
    config: {
      week: week,
      topic: topic,
      unit: unit,
      teacher: teacher,
      questions: allQuestions
    },
    savedAt: new Date().toISOString(),
    savedAtDisplay: new Date().toLocaleString('th-TH')
  };
  
  savedActivities.push(activity);
  localStorage.setItem('savedActivities', JSON.stringify(savedActivities));
  
  alert(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° "${activityName}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
function loadActivity() {
  const savedActivities = JSON.parse(localStorage.getItem('savedActivities') || '[]');
  const mathActivities = savedActivities.filter(a => a.type === 'math');
  
  if (mathActivities.length === 0) {
    alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ');
    return;
  }
  
  const activityList = document.getElementById('activityList');
  activityList.innerHTML = mathActivities.map(activity => `
    <div style="background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; border: 3px solid #74640a; transition: transform 0.2s;" 
         onmouseover="this.style.transform='scale(1.02)'"
         onmouseout="this.style.transform='scale(1)'">
      <div style="display: flex; justify-content: space-between; align-items: start;">
        <div style="flex: 1; cursor: pointer;" onclick="selectActivity(${activity.id})">
          <h3 style="margin: 0 0 8px 0; color: #333; font-size: 18px;">üìö ${activity.name}</h3>
          <p style="margin: 4px 0; color: #666; font-size: 14px;">‡∏™‡∏≤‡∏£‡∏∞: ${activity.topic}</p>
          <p style="margin: 4px 0; color: #999; font-size: 12px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: ${activity.savedAtDisplay}</p>
          <p style="margin: 4px 0; color: #667eea; font-size: 14px; font-weight: 600;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏à‡∏ó‡∏¢‡πå: ${activity.config.questions?.length || 0} ‡∏Ç‡πâ‡∏≠</p>
        </div>
        <div style="display: flex; gap: 8px;">
          <button onclick="event.stopPropagation(); editActivity(${activity.id})" 
                  style="background: #3498db; color: white; border: none; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; font-size: 18px;">
            ‚úèÔ∏è
          </button>
          <button onclick="event.stopPropagation(); deleteActivity(${activity.id})" 
                  style="background: #e74c3c; color: white; border: none; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; font-size: 18px;">
            üóëÔ∏è
          </button>
        </div>
      </div>
    </div>
  `).join('');
  
  document.getElementById('activityModal').style.display = 'flex';
}

// ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
function selectActivity(activityId) {
  const savedActivities = JSON.parse(localStorage.getItem('savedActivities') || '[]');
  const activity = savedActivities.find(a => a.id === activityId);
  
  if (!activity) {
    alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ');
    return;
  }
  
  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
  const config = activity.config;
  document.getElementById('weekInput').value = config.week || '';
  document.getElementById('topicInput').value = config.topic || '';
  document.getElementById('unitInput').value = config.unit || '';
  document.getElementById('teacherInput').value = config.teacher || '';
  
  allQuestions = config.questions || [];
  renderQuestionsList();
  
  closeActivityModal();
  
  alert(`‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏• "${activity.name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
}

// ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
function editActivity(activityId) {
  const savedActivities = JSON.parse(localStorage.getItem('savedActivities') || '[]');
  const activity = savedActivities.find(a => a.id === activityId);
  
  if (!activity) {
    alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ');
    return;
  }
  
  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
  const config = activity.config;
  document.getElementById('weekInput').value = config.week || '';
  document.getElementById('topicInput').value = config.topic || '';
  document.getElementById('unitInput').value = config.unit || '';
  document.getElementById('teacherInput').value = config.teacher || '';
  
  allQuestions = config.questions || [];
  renderQuestionsList();
  
  // ‡πÄ‡∏Å‡πá‡∏ö ID ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
  window.editingActivityId = activityId;
  window.editingActivityName = activity.name;
  
  closeActivityModal();
  
  // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
  alert(`üìù ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° "${activity.name}"\n\n‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î "üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï`);
}

// ‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
function deleteActivity(activityId) {
  if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
  
  let savedActivities = JSON.parse(localStorage.getItem('savedActivities') || '[]');
  savedActivities = savedActivities.filter(a => a.id !== activityId);
  localStorage.setItem('savedActivities', JSON.stringify(savedActivities));
  
  loadActivity();
}

// ‡∏õ‡∏¥‡∏î Modal
function closeActivityModal() {
  document.getElementById('activityModal').style.display = 'none';
}

</script>

</body>
</html>
